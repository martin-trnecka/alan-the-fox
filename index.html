<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Lišák Alan | Katedra Informatiky, Univerzita Palackeho v Olomouci</title>

  <link rel="stylesheet" href="./css/alan.css">

  <!-- knihovna Blocky -->
  <script src="./blocky/blockly.js"></script>
  <script src="./blocky/javascript.js"></script>
  <script src="./blocky/alan_blocks.js"></script>
  <script src="./blocky/alan_generators.js"></script>

  <meta name="author" content="Martin Trnecka, Marketa Trneckova">
</head>

<body>

  <main>

    <canvas id="deska" width="1105" height="700"></canvas>

    <img id="grass1" src="./assets/grass1.svg" class="hidden">       <!-- 1 -->
    <img id="grass2" src="./assets/grass2.svg" class="hidden">       <!-- 2 -->
    <img id="grass3" src="./assets/grass3.svg" class="hidden">       <!-- 3 -->
    <img id="hill1" src="./assets/hill1.svg" class="hidden">         <!-- 4 -->
    <img id="hill2" src="./assets/hill2.svg" class="hidden">         <!-- 5 -->
    <img id="grass4" src="./assets/grass4.svg" class="hidden">       <!-- 6 -->
    <img id="grass5" src="./assets/grass5.svg" class="hidden">       <!-- 7 -->
    <img id="fox1" src="./assets/fox4.svg" class="hidden">           <!-- 201, na kytce 211 -->
    <img id="fox2" src="./assets/fox2.svg" class="hidden">           <!-- 202, na kytce 212 -->
    <img id="fox3" src="./assets/fox1.svg" class="hidden">           <!-- 203, na kytce 213 -->
    <img id="fox4" src="./assets/fox3.svg" class="hidden">           <!-- 204, na kytce 214 -->
    <img id="chicken1" src="./assets/chicken1.svg" class="hidden">   <!-- 301 -->
    <img id="chicken2" src="./assets/chicken2.svg" class="hidden">   <!-- 302 -->
    <img id="tree1" src="./assets/tree1.svg" class="hidden">         <!-- 11 -->
    <img id="tree2" src="./assets/tree2.svg" class="hidden">         <!-- 12 -->
    <img id="tree3" src="./assets/tree3.svg" class="hidden">         <!-- 13 -->
    <img id="tree4" src="./assets/tree4.svg" class="hidden">         <!-- 14 -->
    <img id="water1" src="./assets/water1.svg" class="hidden">       <!-- 31 -->
    <img id="water2" src="./assets/water2.svg" class="hidden">       <!-- 32 -->
    <img id="water3" src="./assets/water3.svg" class="hidden">       <!-- 33 -->
    <img id="water4" src="./assets/water4.svg" class="hidden">       <!-- 34 -->
    <img id="water5" src="./assets/water5.svg" class="hidden">       <!-- 35 -->
    <img id="water6" src="./assets/water6.svg" class="hidden">       <!-- 36 -->
    <img id="water7" src="./assets/water7.svg" class="hidden">       <!-- 37 -->
    <img id="doghouse" src="./assets/dog-house.svg" class="hidden">  <!-- 41 -->
    <img id="barn" src="./assets/barn.svg" class="hidden">           <!-- 42 -->
    <img id="carrot" src="./assets/carrot.svg" class="hidden">       <!-- 43 -->
    <img id="fence1" src="./assets/fence1.svg" class="hidden">       <!-- 51 -->
    <img id="fence2" src="./assets/fence2.svg" class="hidden">       <!-- 52 -->
    <img id="fence3" src="./assets/fence3.svg" class="hidden">       <!-- 53 -->
    <img id="dog1" src="./assets/dog3.svg" class="hidden">           <!-- 401 -->
    <img id="dog2" src="./assets/dog1.svg" class="hidden">           <!-- 402 -->
    <img id="dog3" src="./assets/dog4.svg" class="hidden">           <!-- 403 -->
    <img id="dog4" src="./assets/dog2.svg" class="hidden">           <!-- 404 -->
  </main>

  <script>

  // TODO: uchovavat pozici lisky a smer lisky v promenne
  // Alan the fox
  var hra = {
    hra_prodleva: 2000, // udava prodlevu ve volani zakladnich procedur
    deska:  [[302,  1,  1, 11, 12, 11, 11,  6,  1,302],
             [  1, 31,  1,  2,  6,  1,  1,  1, 31,  1],
             [  2,  1, 32, 32, 34, 31, 31, 35,202,  1],
             [ 11,  7, 31, 31, 31, 31, 31, 35,  1, 11],
             [ 12,  1, 31, 31,  2,402, 31, 31,  6, 11],
             [ 12,  3, 31, 35, 41,  7, 31, 32,  1, 12],
             [ 11,  1, 36, 31, 31, 31, 31, 34,  7, 12],
             [  2,  1, 31, 31, 31, 32, 31, 33,  1,  1],
             [  1, 32,  1,  2,  7,  1,  1,  1, 33,  1],
             [301,  1,  1, 12, 12, 12, 13,  1,  7,301]],

    deska_original: [[302,  1,  1, 11, 12, 11, 11,  6,  1,302],
                     [  1, 31,  1,  2,  6,  1,  1,  1, 31,  1],
                     [  2,  1, 32, 32, 34, 31, 31, 35,202,  1],
                     [ 11,  7, 31, 31, 31, 31, 31, 35,  1, 11],
                     [ 12,  1, 31, 31,  2,  2, 31, 31,  6, 11],
                     [ 12,  3, 31, 35, 41,  7, 31, 32,  1, 12],
                     [ 11,  1, 36, 31, 31, 31, 31, 34,  7, 12],
                     [  2,  1, 31, 31, 31, 32, 31, 33,  1,  1],
                     [  1, 32,  1,  2,  7,  1,  1,  1, 33,  1],
                     [301,  1,  1, 12, 12, 12, 13,  1,  7,301]],

    proved: function(instrukce) {
        //TODO: pausa
        try {
          eval(instrukce);
        } catch (e) {
        alert(e);
      }
      this.nakresli_mapu();
    },

    krok: function() {
      console.log('krok vpřed');

      var zakazane = [0, 4, 5, 11, 12, 13, 14, 31, 32, 33, 34, 35, 36, 37, 41, 42, 43, 51, 52, 53, 401, 402, 403, 404]; // seznam zakazanych policek

      // TODO: výjimky
      var [x, y] = this.najdi_alana();
      if(this.deska[x][y]==201) if(y<10) this.deska[x][y+1]=this.deska[x][y];
      if(this.deska[x][y]==202) if(x<10) this.deska[x+1][y]=this.deska[x][y];
      if(this.deska[x][y]==203) if(y>0) this.deska[x][y-1]=this.deska[x][y];
      if(this.deska[x][y]==204) if(x>0) this.deska[x-1][y]=this.deska[x][y];

      //console.log(JSON.stringify(this.deska));

      this.deska[x][y] = this.deska_original[x][y] ;
    },

    seber_slepici: function() {
      console.log('seber slepici');
      var [x, y] = this.najdi_alana();

      if (this.deska_original[x][y]>300 && this.deska_original[x][y]<305) {
        this.deska_original[x][y] = 1;
      }
    },

    otoc_vpravo: function() {
      console.log('otoc vpravo');
      var [x, y] = this.najdi_alana();
      this.deska[x][y] = this.deska[x][y] + 1;
      if(this.deska[x][y]==205) this.deska[x][y] = 201;
    },

    otoc_vlevo: function() {
      console.log('otoc vlevo');
      var [x, y] = this.najdi_alana();
      this.deska[x][y] = this.deska[x][y] - 1;
      if(this.deska[x][y]==200) this.deska[x][y] = 204;
    },

    podminka_1: function() {
      console.log('over podminku');
      var [x, y] = this.najdi_alana();
      if(this.deska[x][y]>210 && this.deska[x][y]<215)
      {
        alert(0);
        return false;
      }
      alert(1);
      return true;
    },

    // najde lišku
    najdi_alana: function() {
      for (var x = 0; x < 10; x++) {
        for (var y = 0; y < 10; y++) {
          if (this.deska[x][y]>200 && this.deska[x][y]<300)
          {
            return [x,y];
          }
        }
      }
    },

    nakresli_mapu: function() {
      var elem = document.getElementById('deska');
      var context = elem.getContext('2d');

      var scale = 0.9;
      tile1 = document.getElementById("grass1");
      var move_x = tile1.width*scale;
      var move_y = tile1.height*scale - 5*0.9;

      for (var x = 0; x < 10; x++) {
        for (var y = 0; y < 10; y++) {

          // prázdné políčko
          if (this.deska[x][y] == 1 || this.deska[x][y] > 200) {
              tile = document.getElementById("grass1");
              if (this.deska[x][y]) context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50, tile.width*scale, tile.height*scale);
          }

          // trava2
          if (this.deska[x][y] == 2) {
              tile = document.getElementById("grass2");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // trava2
          if (this.deska[x][y] == 3) {
              tile = document.getElementById("grass3");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // hill1
          if (this.deska[x][y] == 4) {
              tile = document.getElementById("hill1");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+ 1*scale, x*move_y/2 + y*move_y/2+50-24*scale, tile.width*scale, tile.height*scale);
          }

          // hill2
          if (this.deska[x][y] == 5) {
              tile = document.getElementById("hill2");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+ 1*scale, x*move_y/2 + y*move_y/2+50-24*scale, tile.width*scale, tile.height*scale);
          }
          
          // trava4
          if (this.deska[x][y] == 6) {
              tile = document.getElementById("grass4");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }
          
          // trava5
          if (this.deska[x][y] == 7) {
              tile = document.getElementById("grass5");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // strom1
          if (this.deska[x][y] == 11) {
              tile = document.getElementById("tree1");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // strom2
          if (this.deska[x][y] == 12) {
              tile = document.getElementById("tree2");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // strom3
          if (this.deska[x][y] == 13) {
              tile = document.getElementById("tree3");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }
          
          // strom4
          if (this.deska[x][y] == 14) {
              tile = document.getElementById("tree4");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // water1
          if (this.deska[x][y] == 31) {
              tile = document.getElementById("water1");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // water2
          if (this.deska[x][y] == 32) {
              tile = document.getElementById("water2");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // water3
          if (this.deska[x][y] == 33) {
              tile = document.getElementById("water3");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // water4
          if (this.deska[x][y] == 34) {
              tile = document.getElementById("water4");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }
          
          // water5
          if (this.deska[x][y] == 35) {
              tile = document.getElementById("water5");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }
          
          // water6
          if (this.deska[x][y] == 36) {
              tile = document.getElementById("water6");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }
          
          // water7
          if (this.deska[x][y] == 37) {
              tile = document.getElementById("water7");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // dog house
          if (this.deska[x][y] == 41) {
              tile = document.getElementById("doghouse");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }

          // barn
          if (this.deska[x][y] == 42) {
              tile = document.getElementById("barn");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }
          
          // carrot
          if (this.deska[x][y] == 43) {
              tile = document.getElementById("carrot");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }
          
          // fence1
          if (this.deska[x][y] == 51) {
              tile = document.getElementById("fence1");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }
          
          // fence2
          if (this.deska[x][y] == 52) {
              tile = document.getElementById("fence2");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }
          
          // fence3
          if (this.deska[x][y] == 53) {
              tile = document.getElementById("fence3");
              var dif_y = tile1.height - tile.height;
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500, x*move_y/2 + y*move_y/2+50+ dif_y*scale, tile.width*scale, tile.height*scale);
          }


          // slepice
          if (this.deska[x][y] == 301) {
              tile = document.getElementById("chicken1");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+35*scale, x*move_y/2 + y*move_y/2+50-12*scale, tile.width*scale, tile.height*scale);
          }

          // slepice
          if (this.deska[x][y] == 302) {
              tile = document.getElementById("chicken2");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+35*scale, x*move_y/2 + y*move_y/2+50-12*scale, tile.width*scale, tile.height*scale);
          }

          // pes
          if (this.deska[x][y] == 401) {
              tile = document.getElementById("dog1");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+15*scale, x*move_y/2 + y*move_y/2+50-48*scale, tile.width*scale*0.9, tile.height*scale*0.9);
          }

          if (this.deska[x][y] == 402) {
              tile = document.getElementById("dog2");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+5*scale, x*move_y/2 + y*move_y/2+50-48*scale, tile.width*scale*0.9, tile.height*scale*0.9);
          }

          if (this.deska[x][y] == 403) {
              tile = document.getElementById("dog3");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500-1*scale, x*move_y/2 + y*move_y/2+50-63*scale, tile.width*scale*0.9, tile.height*scale*0.9);
          }

          if (this.deska[x][y] == 404) {
              tile = document.getElementById("dog4");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+20*scale, x*move_y/2 + y*move_y/2+50-63*scale, tile.width*scale*0.9, tile.height*scale*0.9);
          }



          // TODO: zjednodusit
          // lišák Alan
          if (this.deska[x][y] == 201 || this.deska[x][y] == 211) {
              tile = document.getElementById("fox1");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+10*scale, x*move_y/2 + y*move_y/2+50-55*scale, tile.width*scale, tile.height*scale);
          }

          if (this.deska[x][y] == 202 || this.deska[x][y] == 212) {
              tile = document.getElementById("fox2");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+10*scale, x*move_y/2 + y*move_y/2+50-55*scale, tile.width*scale, tile.height*scale);
          }

          if (this.deska[x][y] == 203|| this.deska[x][y] == 213) {
              tile = document.getElementById("fox3");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+10*scale, x*move_y/2 + y*move_y/2+50-55*scale, tile.width*scale, tile.height*scale);
          }

          if (this.deska[x][y] == 204|| this.deska[x][y] == 214) {
              tile = document.getElementById("fox4");
              context.drawImage(tile, x*(-move_x/2) + y*move_x/2 + 500+10*scale, x*move_y/2 + y*move_y/2+50-55*scale, tile.width*scale, tile.height*scale);
          }



        }
      }
    }
  }


hra.nakresli_mapu();
  </script>






<div id="blocklyDiv" style="height: 480px; width: 600px; float: left;"></div>


<textarea id="textarea" style="height: 480px; width: 600px;"></textarea>
<button onclick="run();">RUN</button>

<xml id="toolbox" style="display: none">
  <block type="krok"></block>
  <block type="seber_slepici"></block>
  <block type="otoc_vlevo"></block>
  <block type="otoc_vpravo"></block>
  <block type="opakuj"></block>
  <block type="opakuj_p1"></block>
</xml>

<script>
Blockly.JavaScript.addReservedWords('code');

var workspace = Blockly.inject('blocklyDiv', {toolbox: document.getElementById('toolbox')});

var code = Blockly.JavaScript.workspaceToCode(workspace)

function myUpdateFunction(event) {
  var code = Blockly.JavaScript.workspaceToCode(workspace);
  document.getElementById('textarea').value = code;
}

workspace.addChangeListener(myUpdateFunction);


// Fox on run :-)
function run() {
  var code = Blockly.JavaScript.workspaceToCode(workspace);

  try {
    eval(code);
  } catch (e) {
  alert(e);
}
}
</script>

</body>
</html>
